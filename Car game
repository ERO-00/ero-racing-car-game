<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ERO的遊戲網站</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="container">
    <h1>ERO的遊戲網站</h1>

    <!-- 進入賽車遊戲 -->
    <a href="MiniRacer-Web/index.html" target="_blank">
        <button class="gameBtn">玩 ERO的賽車遊戲 最終版本</button>
    </a>

    <!-- 下載 APK -->
    <a id="downloadBtn" href="MiniRacer-Web/MiniRacer-Web.apk" download>
        <button class="downloadBtn">下載 APK 版本</button>
    </a>

    <!-- 下載次數 -->
    <p>下載次數：<span id="downloadCount">0</span></p>
</div>

<script>
// ----- Firebase 初始化 -----
const firebaseConfig = {
    apiKey: "你的APIKEY",
    authDomain: "你的專案ID.firebaseapp.com",
    projectId: "你的專案ID",
    storageBucket: "你的專案ID.appspot.com",
    messagingSenderId: "你的SENDERID",
    appId: "你的APPID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ----- 計數器程式 -----
const downloadBtn = document.getElementById('downloadBtn');
const downloadCount = document.getElementById('downloadCount');

async function updateCounter() {
    const docRef = db.collection('downloads').doc('MiniRacer');
    const docSnap = await docRef.get();
    downloadCount.innerText = docSnap.exists ? docSnap.data().count : 0;
}

downloadBtn.addEventListener('click', async ()=>{
    const docRef = db.collection('downloads').doc('MiniRacer');
    await db.runTransaction(async (t) => {
        const doc = await t.get(docRef);
        const newCount = (doc.exists ? doc.data().count : 0) + 1;
        t.set(docRef, {count: newCount});
        downloadCount.innerText = newCount;
    });
});

updateCounter();
</script>
</body>
</html>

body, html {
    margin:0; padding:0;
    font-family:'Arial', sans-serif;
    background: linear-gradient(to bottom, #0d0d0d, #1a1a1a);
    color:#0ff;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.container {text-align:center;}

h1 {
    font-size:2.5rem;
    margin-bottom:2rem;
    text-shadow:0 0 10px #0ff;
}

button {
    padding:15px 30px;
    margin:10px;
    font-size:1.2rem;
    border:none;
    border-radius:12px;
    cursor:pointer;
    transition: all 0.2s ease;
}

button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px #0ff;
}

.gameBtn {background:#0ff; color:#000;}
.downloadBtn {background:#ff0; color:#000;}

p {font-size:1.2rem; margin-top:2rem;}

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ERO的賽車遊戲 最終版本</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div id="gameContainer">
    <div id="menu">
        <h1>ERO的賽車遊戲 最終版本</h1>
        <p>選擇你的賽車：</p>
        <div id="carSelection"></div>
        <p>選擇難度：</p>
        <select id="difficulty">
            <option value="easy">簡單</option>
            <option value="medium">普通</option>
            <option value="hard">困難</option>
        </select>
        <button id="startBtn">開始遊戲</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="scoreBoard">
        <p>分數: <span id="score">0</span></p>
        <button id="restartBtn">重新開始</button>
    </div>
</div>
<script src="game.js"></script>
</body>
</html>

* {margin:0; padding:0; box-sizing:border-box; font-family:'Arial', sans-serif;}
body, html {height:100%; width:100%; overflow:hidden; background:#000;}

#gameContainer {position:relative; width:100%; height:100%;}

#menu {
    position:absolute; top:0; left:0; width:100%; height:100%;
    background:#111; color:#0ff;
    display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;
}

#carSelection {display:flex; gap:10px; margin:1rem;}
.carOption {width:60px; height:100px; border:2px solid #0ff; border-radius:10px; cursor:pointer;}
.carOption.selected {border-color:#ff0; box-shadow:0 0 10px #ff0;}

#difficulty {margin:1rem; padding:0.5rem; font-size:1rem;}
#startBtn {padding:10px 20px; font-size:1.2rem; cursor:pointer; background:#0ff; color:#000; border:none; border-radius:10px;}

canvas {display:block; width:100%; height:100%; background:#222;}

#scoreBoard {
    position:absolute; top:10px; left:10px; color:#0ff; font-size:1.2rem; display:none;
}
#restartBtn {padding:5px 10px; margin-top:5px; font-size:1rem; cursor:pointer;}

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let menu = document.getElementById('menu');
let startBtn = document.getElementById('startBtn');
let scoreBoard = document.getElementById('scoreBoard');
let scoreEl = document.getElementById('score');
let restartBtn = document.getElementById('restartBtn');
let difficultySelect = document.getElementById('difficulty');

let gameRunning = false;
let score = 0;

const cars = [
    {name:'速度型', color:'#f00', speed:8, control:3},
    {name:'平衡型', color:'#0f0', speed:6, control:5},
    {name:'操控型', color:'#00f', speed:5, control:8},
    {name:'平均型', color:'#ff0', speed:6, control:6},
    {name:'特別型', color:'#f0f', speed:7, control:7}
];
let selectedCar = cars[0];

let carSelection = document.getElementById('carSelection');
cars.forEach((car,index)=>{
    let div = document.createElement('div');
    div.classList.add('carOption');
    div.style.background = car.color;
    div.addEventListener('click',()=> {
        document.querySelectorAll('.carOption').forEach(c=>c.classList.remove('selected'));
        div.classList.add('selected');
        selectedCar = car;
    });
    if(index===0) div.classList.add('selected');
    carSelection.appendChild(div);
});

let player = {x:canvas.width/2, y:canvas.height-150, width:50, height:100};
let obstacles = [];

function getBackgroundColor() {
    let hour = new Date().getHours();
    if(hour>=5 && hour<8) return '#FFFAE3';
    if(hour>=8 && hour<12) return '#B3E5FC';
    if(hour>=12 && hour<15) return '#FFF59D';
    if(hour>=15 && hour<18) return '#FFCC80';
    if(hour>=18 && hour<20) return '#FFAB91';
    return '#0D47A1';
}

function checkCollision(a,b){
    return !(a.x + a.width < b.x || a.x > b.x + b.width || a.y + a.height < b.y || a.y > b.y + b.height);
}

function spawnObstacle() {
    let width = 50 + Math.random()*50;
    let x = Math.random()*(canvas.width-width);
    obstacles.push({x:x, y:-100, width:width, height:30});
}

function update() {
    ctx.fillStyle = getBackgroundColor();
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // 畫玩家
    ctx.fillStyle = selectedCar.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // 畫障礙物
    obstacles.forEach(ob=>{
        ob.y += selectedCar.speed * (difficultySelect.value==='easy'?0.7:difficultySelect.value==='medium'?1:1.5);
        ctx.fillStyle = '#888';
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
        if(checkCollision(player, ob)) gameOver();
    });

    obstacles = obstacles.filter(ob=>ob.y<canvas.height);

    // 分數
    score += 0.1;
    scoreEl.innerText = Math.floor(score);

    if(gameRunning) requestAnimationFrame(update);
}

setInterval(()=>{
    if(gameRunning) spawnObstacle();
}, 1500);

startBtn.addEventListener('click', ()=>{
    menu.style.display='none';
    scoreBoard.style.display='block';
    gameRunning=true;
    score=0;
    obstacles=[];
    player.x=canvas.width/2;
    update();
});

function gameOver(){
    gameRunning=false;
    alert('遊戲結束！分數：'+Math.floor(score));
    menu.style.display='flex';
    scoreBoard.style.display='none';
}

restartBtn.addEventListener('click', ()=>{
    menu.style.display='flex';
    scoreBoard.style.display='none';
    gameRunning=false;
});

let touchStartX = 0;
canvas.addEventListener('touchstart', e=>{touchStartX=e.touches[0].clientX;});
canvas.addEventListener('touchmove', e=>{
    let touchX = e.touches[0].clientX;
    let diff = touchX - touchStartX;
    player.x += diff/15 * selectedCar.control;
    if(player.x<0) player.x=0;
    if(player.x+player.width>canvas.width) player.x=canvas.width-player.width;
    touchStartX = touchX;
});

window.addEventListener('keydown', e=>{
    if(e.key==='ArrowLeft') player.x -= selectedCar.control*5;
    if(e.key==='ArrowRight') player.x += selectedCar.control*5;
    if(player.x<0) player.x=0;
    if(player.x+player.width>canvas.width) player.x=canvas.width-player.width;
});

window.addEventListener('resize', ()=>{
    canvas.width=window.innerWidth;
    canvas.height=window.innerHeight;
    player.y = canvas.height-150;
});

